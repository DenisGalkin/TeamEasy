{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h1>
    <p>–ò–∑–º–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
</div>

<div class="card">
    <div class="card-content">
        <div class="profile-photo-section">
            <div class="profile-photo-container">
                <img src="{{ current_user.get_profile_photo_url() }}"
                     alt="Profile Photo"
                     class="profile-photo"
                     id="profilePhoto">
                <label class="profile-photo-upload" title="Change photo">
                    üì∑
                    <input type="file"
                           id="profilePhotoInput"
                           name="profile_photo"
                           accept=".png,.jpg,.jpeg,.gif"
                           onchange="previewProfilePhoto(event)">
                </label>
            </div>

            {% if current_user.profile_photo != 'default-avatar.png' %}
            <div class="photo-actions">
                <form method="POST" action="{{ url_for('delete_profile_photo') }}"
                      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è?')">
                    <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 12px;">–£–¥–∞–ª–∏—Ç—å
                        —Ñ–æ—Ç–æ
                    </button>
                </form>
            </div>
            {% endif %}

            <div style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 12px;">–†–∞–∑–º–µ—Ä - –¥–æ 2MB ‚Ä¢ PNG, JPG,
                JPEG, GIF
            </div>
        </div>

        <form method="POST" enctype="multipart/form-data">
            <input type="file" id="hiddenFileInput" name="profile_photo" accept=".png,.jpg,.jpeg,.gif"
                   style="display: none;">

            <div class="grid grid-cols-2" style="gap: 1.5rem;">
                <div class="form-group">
                    <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="username" name="username" class="form-control"
                           value="{{ current_user.username }}" disabled>
                    <small style="color: var(--text-secondary); font-size: 12px; margin-top: 0.25rem; display: block;">–ò–º—è
                        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å</small>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" class="form-control"
                           value="{{ current_user.email }}" required>
                </div>
            </div>

            <div class="grid grid-cols-2" style="gap: 1.5rem;">
                <div class="form-group">
                    <label for="github">GitHub –ø—Ä–æ—Ñ–∏–ª—å</label>
                    <input type="url" id="github" name="github" class="form-control"
                           value="{{ current_user.github or '' }}" placeholder="https://github.com/username">
                </div>

                <div class="form-group">
                    <label for="telegram">Telegram —é–∑–µ—Ä–Ω–µ–π–º</label>
                    <div style="display: flex;">
                        <span style="background: var(--sidebar-bg); padding: 0.75rem; border: 1px solid var(--border-color); 
                              border-right: none; border-radius: 8px 0 0 8px; display: flex; align-items: center; font-size: 14px;">@</span>
                        <input type="text" id="telegram" name="telegram" class="form-control"
                               value="{{ current_user.telegram or '' }}" placeholder="username"
                               style="border-radius: 0 8px 8px 0; border-left: none;">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="bio">–û —Å–µ–±–µ</label>
                <textarea id="bio" name="bio" class="form-control" rows="4"
                          placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ">{{ current_user.bio or '' }}</textarea>
                <small style="color: var(--text-secondary); font-size: 12px; margin-top: 0.25rem; display: block;">–ú–∞–∫—Å–∏–º—É–º
                    500 —Å–∏–º–≤–æ–ª–æ–≤</small>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <a href="{{ url_for('profile', username=current_user.username) }}" class="btn btn-outline">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</div>

<script>
    function previewProfilePhoto(event) {
        const file = event.target.files[0];
        if (file) {
            // Check size
            if (file.size > 2 * 1024 * 1024) {
                alert('File is too large. Maximum size is 2MB.');
                event.target.value = '';
                return;
            }

            // Check file type
            const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                alert('Invalid file type. Please use PNG, JPG, JPEG, or GIF.');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('profilePhoto').src = e.target.result;
            }
            reader.readAsDataURL(file);

            document.getElementById('hiddenFileInput').files = event.target.files;
        }
    }

    document.getElementById('profilePhotoInput').addEventListener('click', function(e) {
        e.stopPropagation();
    });

    document.getElementById('profilePhoto').addEventListener('click', function() {
        document.getElementById('profilePhotoInput').click();
    });
</script>
{% endblock %}